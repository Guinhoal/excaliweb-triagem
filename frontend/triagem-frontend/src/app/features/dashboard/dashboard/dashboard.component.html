<header class="header">
  <div class="logo">Excaliweb <span>para UNIMED-BH</span></div>
  <div class="doctor-welcome" style="color: white; font-weight: bold;">
    üë®‚Äç‚öïÔ∏è Bem-vindo, Dr(a). {{ doctorName }}
  </div>
  <nav class="header-nav">
    <a (click)="logout()" class="nav-button" style="cursor: pointer;">Logout</a>
  </nav>
</header>

<main class="main-container dashboard-container">
  <div class="dashboard-header">
    <h1>Dashboard M√©dico - Casos de Triagem</h1>
    <p>Visualize e gerencie os casos que precisam de sua aten√ß√£o m√©dica.</p>
    
    <!-- Controles de Visualiza√ß√£o -->
    <div class="view-controls">
      <div class="view-options">
        <button 
          class="view-btn" 
          [class.active]="viewMode === 'grid'"
          (click)="setViewMode('grid')"
          title="Visualiza√ß√£o em Grade">
          <i class="fas fa-th"></i>
        </button>
        <button 
          class="view-btn" 
          [class.active]="viewMode === 'list'"
          (click)="setViewMode('list')"
          title="Visualiza√ß√£o em Lista">
          <i class="fas fa-list"></i>
        </button>
        <button 
          class="view-btn" 
          [class.active]="viewMode === 'carousel'"
          (click)="setViewMode('carousel')"
          title="Visualiza√ß√£o em Carrossel">
          <i class="fas fa-images"></i>
        </button>
      </div>
      
      <div class="sort-options">
        <select [(ngModel)]="sortBy" (change)="sortPatients()">
          <option value="urgency">Ordenar por Urg√™ncia</option>
          <option value="name">Ordenar por Nome</option>
          <option value="age">Ordenar por Idade</option>
          <option value="duration">Ordenar por Dura√ß√£o</option>
        </select>
        
        <button 
          class="sort-btn" 
          (click)="toggleSortDirection()"
          [title]="sortDirection === 'asc' ? 'Crescente' : 'Decrescente'">
          <i class="fas" [class.fa-sort-amount-up]="sortDirection === 'asc'" [class.fa-sort-amount-down]="sortDirection === 'desc'"></i>
        </button>
      </div>
    </div>
    
    <div class="stats-summary">
      <div class="stat-card red">
        <span class="stat-number">{{ getPatientsByUrgency('red').length }}</span>
        <span class="stat-label">Emerg√™ncia</span>
      </div>
      <div class="stat-card orange">
        <span class="stat-number">{{ getPatientsByUrgency('orange').length }}</span>
        <span class="stat-label">Muita Urg√™ncia</span>
      </div>
      <div class="stat-card yellow">
        <span class="stat-number">{{ getPatientsByUrgency('yellow').length }}</span>
        <span class="stat-label">Urg√™ncia</span>
      </div>
      <div class="stat-card green">
        <span class="stat-number">{{ getPatientsByUrgency('green').length }}</span>
        <span class="stat-label">Pouca Urg√™ncia</span>
      </div>
    </div>
  </div>

  <!-- Visualiza√ß√£o em Grade -->
  <div *ngIf="viewMode === 'grid'" class="dashboard-grid">
    <div 
      *ngFor="let patient of sortedPatients" 
      class="patient-card" 
      [ngClass]="patient.urgency"
      (click)="openPatientModal(patient)">
      <h3>{{ patient.name }}</h3>
      <div class="patient-info">
        <p><strong>Idade:</strong> <span>{{ patient.age }} anos</span></p>
        <p><strong>Sintoma:</strong> <span>{{ patient.symptom }}</span></p>
        <p><strong>Dura√ß√£o:</strong> <span>{{ patient.duration }}</span></p>
        <p><strong>Status:</strong> <span class="urgency-label" [ngClass]="patient.urgency">{{ getUrgencyLabel(patient.urgency) }}</span></p>
      </div>
    </div>
  </div>

  <!-- Visualiza√ß√£o em Lista -->
  <div *ngIf="viewMode === 'list'" class="dashboard-list">
    <div class="list-header">
      <div class="list-col">Nome</div>
      <div class="list-col">Idade</div>
      <div class="list-col">Sintoma</div>
      <div class="list-col">Dura√ß√£o</div>
      <div class="list-col">Urg√™ncia</div>
      <div class="list-col">A√ß√µes</div>
    </div>
    <div 
      *ngFor="let patient of sortedPatients" 
      class="list-row" 
      [ngClass]="patient.urgency">
      <div class="list-col">{{ patient.name }}</div>
      <div class="list-col">{{ patient.age }} anos</div>
      <div class="list-col">{{ patient.symptom }}</div>
      <div class="list-col">{{ patient.duration }}</div>
      <div class="list-col">
        <span class="urgency-label" [ngClass]="patient.urgency">{{ getUrgencyLabel(patient.urgency) }}</span>
      </div>
      <div class="list-col">
        <button 
          (click)="openPatientModal(patient)" 
          class="btn-primary btn-small">
          Ver Detalhes
        </button>
      </div>
    </div>
  </div>

  <!-- Visualiza√ß√£o em Carrossel -->
  <div *ngIf="viewMode === 'carousel'" class="dashboard-carousel">
    <div class="carousel-container">
      <button 
        class="carousel-btn carousel-prev" 
        (click)="previousSlide()"
        [disabled]="currentSlide === 0">
        <i class="fas fa-chevron-left"></i>
      </button>
      
      <div class="carousel-content">
        <div class="carousel-track" [style.transform]="'translateX(' + (-currentSlide * 100) + '%)'">
          <div 
            *ngFor="let patient of sortedPatients; let i = index" 
            class="carousel-slide">
            <div 
              class="patient-card carousel-card" 
              [ngClass]="patient.urgency"
              (click)="openPatientModal(patient)">
              <h3>{{ patient.name }}</h3>
              <div class="patient-info">
                <p><strong>Idade:</strong> <span>{{ patient.age }} anos</span></p>
                <p><strong>Sintoma:</strong> <span>{{ patient.symptom }}</span></p>
                <p><strong>Dura√ß√£o:</strong> <span>{{ patient.duration }}</span></p>
                <p><strong>Status:</strong> <span class="urgency-label" [ngClass]="patient.urgency">{{ getUrgencyLabel(patient.urgency) }}</span></p>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <button 
        class="carousel-btn carousel-next" 
        (click)="nextSlide()"
        [disabled]="currentSlide >= sortedPatients.length - 1">
        <i class="fas fa-chevron-right"></i>
      </button>
    </div>
    
    <div class="carousel-indicators">
      <button 
        *ngFor="let patient of sortedPatients; let i = index"
        class="indicator"
        [class.active]="i === currentSlide"
        (click)="goToSlide(i)">
      </button>
    </div>
  </div>

  <div *ngIf="sortedPatients.length === 0" class="empty-state">
    <h3>Nenhum paciente na fila</h3>
    <p>Quando houver novos casos de triagem, eles aparecer√£o aqui.</p>
  </div>
</main>

<!-- Modal para Detalhes do Paciente -->
<div 
  *ngIf="selectedPatient" 
  class="modal-overlay" 
  [class.hidden]="!showModal"
  (click)="closeModal()">
  <div class="modal-content analysis-card" (click)="$event.stopPropagation()">
    <button class="modal-close-btn" (click)="closeModal()">&times;</button>
    <h2>{{ selectedPatient.name }}</h2>
    <div class="patient-data">
      <div class="data-item">
        <strong>Idade:</strong>
        <span>{{ selectedPatient.age }} anos</span>
      </div>
      <div class="data-item">
        <strong>Sintoma Principal:</strong>
        <span>{{ selectedPatient.symptom }}</span>
      </div>
      <div class="data-item">
        <strong>Dura√ß√£o:</strong>
        <span>{{ selectedPatient.duration }}</span>
      </div>
      <div class="data-item">
        <strong>Outros Sintomas:</strong>
        <span>{{ selectedPatient.otherSymptoms }}</span>
      </div>
      <div class="data-item">
        <strong>N√≠vel de Urg√™ncia:</strong>
        <span class="urgency-label" [ngClass]="selectedPatient.urgency">{{ getUrgencyLabel(selectedPatient.urgency) }}</span>
      </div>
    </div>
    
    <div class="doctor-notes">
      <label for="doctorNotes">Recomenda√ß√£o da Consulta:</label>
      <textarea 
        [(ngModel)]="doctorNotes" 
        rows="5" 
        placeholder="Digite a an√°lise e recomenda√ß√£o para o paciente...">
      </textarea>
    </div>
    
    <div class="modal-actions">
      <button 
        (click)="sendAnalysis()" 
        class="btn-primary"
        [disabled]="!doctorNotes.trim()">
        Enviar An√°lise
      </button>
      <button 
        (click)="markAsCompleted()" 
        class="btn-secondary"
        style="margin-left: 1rem;">
        Marcar como Atendido
      </button>
    </div>
  </div>
</div>

<footer class="footer">
  <p>&copy; 2025 Excaliweb. Todos os direitos reservados.</p>
</footer>
